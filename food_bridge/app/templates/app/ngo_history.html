<!DOCTYPE html>
<html>
<head>
    <title>NGO Dashboard History</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f5f5f5; padding: 20px; }
        h1 { text-align: center; }
        table { width: 100%; background: white; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px 15px; border: 1px solid #ccc; text-align: left; }
        th { background: #2c3e50; color: white; }
        .status { padding: 5px 8px; border-radius: 4px; color: white; font-weight: bold; }
        .Pending { background: #f39c12; }
        .Accepted { background: #3498db; }
        .Collected { background: #9b59b6; }
        .Delivered { background: #2ecc71; }
        .btn-update { background: #34495e; color: white; padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-update:hover { background: #2c3e50; }
    </style>
</head>
<body>
    <h1>NGO Dashboard History</h1>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Food Item</th>
                <th>Quantity</th>
                <th>Pickup Address</th>
                <th>Status</th>
              
            </tr>
        </thead>
        <tbody>
            {% if deliveries %}
                {% for d in deliveries %}
                    <tr>
                        <td>{{ d.id }}</td>
                        <td>{{ d.donation.food_type }}</td>
                        <td>{{ d.donation.quantity }}</td>
                        <td>{{ d.donation.pickup_address }}</td>
                        <td>{{ d.status }}</td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="6" style="text-align:center;">No deliveries found.</td></tr>
            {% endif %}
            <a href="{% url 'ngo_dashboard' %}" 
   style="display:inline-block; margin-top:15px; padding:8px 12px; background:#3498db; color:white; text-decoration:none; border-radius:5px;">
   â¬… Back
</a>

        </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function(){
        $('.btn-update').click(function(){
            var button = $(this);
            var deliveryId = button.data('id');

            $.ajax({
                url: '/ajax/update_status/' + deliveryId + '/',
                type: 'POST',
                headers: { 'X-CSRFToken': '{{ csrf_token }}' },
                success: function(response) {
                    var statusSpan = button.closest('tr').find('.status');
                    statusSpan.text(response.status)
                              .removeClass()
                              .addClass('status ' + response.status);

                    if (response.status === 'Delivered') {
                        button.replaceWith('<span>Completed</span>');
                    }
                },
                error: function() {
                    alert('Something went wrong!');
                }
            });
        });
    });
    </script>
</body>
</html>